tinymce.PluginManager.add("tech5sfilemanager", function(e) {
    function n(t) {
        console.log(t);
        0 === e.settings.external_filemanager_path.toLowerCase().indexOf(t.origin.toLowerCase()) && "tech5sfilemanager" === t.data.sender && (tinymce.activeEditor.insertContent(t.data.html), tinymce.activeEditor.windowManager.close(), window.removeEventListener ? window.removeEventListener("message", n, !1) : window.detachEvent("onmessage", n))
    }

    function t() {
        var t = $(window).innerWidth() - 30,
            i = $(window).innerHeight() - 60;
        t > 1800 && (t = 1800), i > 1200 && (i = 1200);
        var a = (t - 20) % 138;
        if (t = t - a + 10, t > 600) {
            var a = (t - 20) % 138;
            t = t - a + 10
        }
        e.focus(!0);
        var s = "Tech5s File Manager";
        "undefined" != typeof e.settings.filemanager_title && e.settings.filemanager_title && (s = e.settings.filemanager_title);
        var r = "key";
        "undefined" != typeof e.settings.filemanager_access_key && e.settings.filemanager_access_key && (r = e.settings.filemanager_access_key);
        var o = "";
        "undefined" != typeof e.settings.filemanager_sort_by && e.settings.filemanager_sort_by && (o = "&sort_by=" + e.settings.filemanager_sort_by);
        var g = "false";
        win = e.windowManager.open({
            title: s,
            file: e.settings.external_filemanager_path+"?istiny=1",
            width: t,
            height: i,
            inline: 1,
            resizable: !0,
            maximizable: !0
            
        }
        , {
        oninsert: function(html) {
            tinymce.activeEditor.insertContent(html);tinymce.activeEditor.windowManager.close();
        }
    }


        )
    }
    e.addButton("tech5sfilemanager", {
        icon: "browse",
        tooltip: "Thêm tệp tin",
        shortcut: "Ctrl+E",
        onclick: t
    }), e.addShortcut("Ctrl+E", "", t), e.addMenuItem("tech5sfilemanager", {
        icon: "browse",
        text: "Thêm tệp tin",
        shortcut: "Ctrl+E",
        onclick: t,
        context: "insert"
    })
});